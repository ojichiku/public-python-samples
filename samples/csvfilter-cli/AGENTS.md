# csvfilter-cli 仕様 (確定版)

## 概要
- CSV を行単位でストリーム処理し、指定した条件に一致する行のみを出力するシンプルな CLI。
- 入力は UTF-8 の CSV。標準入力は非対応。出力は標準出力（デフォルト）または指定ファイルに上書き。

## 実行方法（インターフェース）
- 例: `python -m csvfilter_cli --input INPUT.csv --and col:op:val [--and col:op:val ...] [--output OUT.csv] [--delimiter ,] [--quotechar \"] [--no-header] [-v]`
- オプション
  - `--input PATH` : 入力 CSV パス（必須）。標準入力は非対応。
  - `--output PATH` : 出力先パス。未指定時は標準出力。指定時は上書き。
  - `--delimiter` : 区切り文字（デフォルト`,`）。
  - `--quotechar` : クオート文字（デフォルト`"`）。
  - `--no-header` : 先頭行をヘッダーとして扱わず、データとして扱う。
  - `--and col:op:val` : AND 条件を複数指定可。`col` はヘッダーありならカラム名、`--no-header` 時は 1 始まり列番号。
  - `-v` : 処理件数・マッチ件数・スキップ件数を stderr に出力。

## フィルター仕様
- 演算子は 2 種類のみ
  - `contains` : 部分一致（部分文字列を含む）。
  - `regex` : Python `re` による正規表現マッチ（フラグなし）。コンパイル失敗でエラー終了。
- 複数条件は AND のみ。指定順に評価（短絡は不要）。
- 大文字小文字無視や数値比較はなし。

## 行・カラムの扱い
- ヘッダーあり: カラム名で指定。存在しないカラム名はエラー終了。
- `--no-header` 時: 列番号は 1 始まり。範囲外列を参照する行はスキップ。
- 行にカラムが足りない場合: スキップ扱い。`-v` でスキップ件数を表示。

## 出力と終了コード
- 条件一致 0 件でも終了コード 0。ただし stderr に「0 rows matched」などのメッセージを出す。
- 正常時は入力順を維持して出力。

## エラー条件（終了コード非 0）
- 入力ファイルが存在しない/読めない。
- 無効な演算子（`contains`/`regex` 以外）。
- ヘッダーありでのカラム未存在。
- `--and` の書式不正（`col:op:val` でない）。
- 正規表現コンパイルエラー。

## ログ/冗長出力 (-v)
- stderr に処理行数、マッチ行数、スキップ行数を表示。

## テスト観点
- contains / regex の基本フィルター。
- 複数 AND 条件の組み合わせ。
- ヘッダーあり/なし（1 始まり列番号）。
- 区切り・クオート指定の反映。
- カラム不足行のスキップ挙動と `-v` 出力。
- 0 件マッチ時のメッセージ + 終了コード 0。
- 無効演算子・正規表現エラー・カラム未存在エラー。
